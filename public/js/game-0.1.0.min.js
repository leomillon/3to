/*!
 * 3to v0.1.0
 * LÃ©o Millon <millon.leo@gmail.com>
 * 2014-03-28
 */
function updateStatus(a){$(Selectors.gameStatus).text(a)}function canPlayerPlay(a){return a.gameReady&&a.playerTurn===playerState&&!a.gameOver}function displayableState(a){return a===Constants.State.X||a===Constants.State.O?a:""}function displayError(a){console.err(a)}function unselect(){$("."+Selectors.selectedClassName).removeClass(Selectors.selectedClassName)}function sendChoice(a,b){null!=a&&null!=b&&(console.log('Emitting "player moved" event'),socket.emit("player moved",{selectedRow:a,selectedColumn:b,playerState:playerState}),unselect())}function updateGame(a){var b=a.grid,c=a.gridSize;a.gameReady&&updateStatus(a.gameOver?a.winner===playerState?Messages.YOU_WIN:Messages.YOU_LOSE:a.playerTurn===playerState?Messages.YOUR_TURN:Messages.OPP_TURN);for(var d=0;c>d;d++)for(var e=0;c>e;e++){var f=b[d][e],g=$(Selectors.cell+d+"_"+e);g.removeClass(Selectors.selectedClassName),f===Constants.State.BLANK&&canPlayerPlay(a)?g.addClass(Selectors.selectableClassName):g.removeClass(Selectors.selectableClassName),g.text(displayableState(f))}}!function(a){a.constants={State:{X:"X",O:"O",BLANK:null},MIN_PLAYER:2,MAX_PLAYER:2,MAX_GRID_SIZE:3}}("undefined"==typeof exports?this.common={}:exports);var Constants=common.constants,Selectors={body:"body",gameStatus:"#game-status",gameData:"#game-data",gameId:"#game-id",cell:"#grid_",row:"data-row",column:"data-column",selectedClassName:"selected",selectableClassName:"selectable"},Messages={WAITING_OPP:"Waiting for the opponent to join the game...",YOUR_TURN:"It's your turn to play",OPP_TURN:"The opponent is playing...",YOU_WIN:"You win !!!",YOU_LOSE:"You lose!!!"},playerState=Constants.State.BLANK,socket=null;updateStatus(Messages.WAITING_OPP),$(function(){var a=$(Selectors.gameData),b=a.find(Selectors.gameId).val();socket=io.connect(),socket.on("connect",function(){console.log("connected!"),socket.emit("join game",{gameId:b})}),socket.on("game joined",function(a,b,c){null==a?(playerState=b,updateGame(c)):displayError(a)}),socket.on("game updated",function(a,b){null==a?updateGame(b):displayError(a)}),socket.on("error",function(a){console.error("Error: ",a)}),$(Selectors.body).on("click","."+Selectors.selectableClassName,function(){$("."+Selectors.selectedClassName).text(displayableState(Constants.State.BLANK)),$("."+Selectors.selectableClassName).removeClass(Selectors.selectedClassName),$(this).toggleClass(Selectors.selectedClassName).text(displayableState(playerState));var a=$(this).attr(Selectors.row),b=$(this).attr(Selectors.column);sendChoice(a,b)})});