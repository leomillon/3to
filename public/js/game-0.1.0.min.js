/*!
 * 3to v0.1.0
 * LÃ©o Millon <millon.leo@gmail.com>
 * 2014-04-04
 */
function updateStatus(a){$(Selectors.gameStatus).text(a)}function canPlayerPlay(a){return a.gameReady&&a.playerTurn===playerState&&!a.gameOver}function displayableState(a){return a===Constants.State.X||a===Constants.State.O?a:""}function displayError(a){console.error(a),alert("error : "+a)}function unselect(){$("."+Selectors.selectedClassName).removeClass(Selectors.selectedClassName)}function sendChoice(a,b){null!=a&&null!=b&&(console.log('Emitting "player moved" event'),socket.emit("player moved",{selectedRow:a,selectedColumn:b,playerState:playerState}),unselect())}function updateGame(a){var b=a.grid,c=a.gridSize;if(a.gameReady){var d;d=a.gameOver?a.winner===playerState?Messages.YOU_WIN:a.winner===Constants.State.BLANK?Messages.NO_WINNER:Messages.YOU_LOSE:a.playerTurn===playerState?Messages.YOUR_TURN:Messages.OPP_TURN,updateStatus(d)}for(var e=0;c>e;e++)for(var f=0;c>f;f++){var g=b[e][f],h=$(Selectors.cell+e+"_"+f);h.removeClass(Selectors.selectedClassName),g===Constants.State.BLANK&&canPlayerPlay(a)?h.addClass(Selectors.selectableClassName):h.removeClass(Selectors.selectableClassName),h.text(displayableState(g))}}!function(a){function b(){var a={Method:{GET:"GET",POST:"POST"}},b=function(a){return"undefined"==typeof a},c=function(a){return!b(a)},d=function(a,b){return c(a)&&a.toUpperCase()===b.toUpperCase()},e=function(b){return d(b,a.Method.POST)},f=function(b){return d(b,a.Method.GET)};this.isUndefined=b,this.isDefined=c,this.isPost=e,this.isGet=f}a.constants={State:{X:"X",O:"O",BLANK:null},MIN_PLAYER:2,MAX_PLAYER:2,MAX_GRID_SIZE:3},a.utils=new b}("undefined"==typeof exports?this.common={}:exports);var Constants=common.constants,Selectors={body:"body",gameStatus:"#game-status",gameData:"#game-data",gameId:"#game-id",cell:"#grid_",row:"data-row",column:"data-column",selectedClassName:"selected",selectableClassName:"selectable"},Messages={WAITING_OPP:"Waiting for the opponent to join the game...",YOUR_TURN:"It's your turn to play",OPP_TURN:"The opponent is playing...",YOU_WIN:"You win !!!",YOU_LOSE:"You lose!!!",NO_WINNER:"Game is over, nobody win."},playerState=Constants.State.BLANK,socket=null;updateStatus(Messages.WAITING_OPP),$(function(){var a=$(Selectors.gameData),b=a.find(Selectors.gameId).val();socket=io.connect(),socket.on("connect",function(){console.log("connected!"),socket.emit("join game",{gameId:b})}),socket.on("game joined",function(a,b,c){null==a?(playerState=b,updateGame(c)):displayError(a)}),socket.on("game updated",function(a,b){null==a?updateGame(b):displayError(a)}),socket.on("error",function(a){displayError(a)}),$(Selectors.body).on("click","."+Selectors.selectableClassName,function(){$("."+Selectors.selectedClassName).text(displayableState(Constants.State.BLANK)),$("."+Selectors.selectableClassName).removeClass(Selectors.selectedClassName),$(this).toggleClass(Selectors.selectedClassName).text(displayableState(playerState));var a=$(this).attr(Selectors.row),b=$(this).attr(Selectors.column);sendChoice(a,b)})});